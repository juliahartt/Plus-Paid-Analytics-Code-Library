SELECT
  DATE_TRUNC(DATE(l.created_at), MONTH) AS lead_month,
  l.lead_source_original AS lead_source,
  COUNT(DISTINCT lv.lead_id) AS lead_volume,
  SUM(lv.last_touch_adjusted_dlv_usd) AS dlv,
  SUM(lv.last_touch_iadjusted_dlv_usd) AS idlv
FROM `shopify-dw.mart_commercial_optimization.dollar_lead_value_attribution` lv
JOIN `shopify-dw.sales.sales_leads` l
  ON lv.lead_id = l.lead_id
JOIN `shopify-dw.raw_salesforce_banff.lead` bl
  ON lv.lead_id = bl.id
WHERE lv.is_last_touchpoint IS TRUE
  AND lv.product IN ('Plus', 'Commerce Components')
  AND DATE(l.created_at) >= '2024-01-01'
GROUP BY 1, 2
ORDER BY 1, 2;
